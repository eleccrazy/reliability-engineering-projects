global
    log /dev/log local0
    log /dev/log local1 notice
    daemon
    tune.ssl.default-dh-param 2048

defaults
    log     global
    option  httplog
    option  dontlognull
    timeout connect 5000
    timeout client  50000
    timeout server  50000

frontend http_in
    bind *:80
    acl url_acme path_beg /.well-known/acme-challenge/
    use_backend acme_challenge if url_acme
    default_backend app_servers

frontend https_in
    bind *:443 ssl crt /etc/haproxy/certs/app.gizachewkassa.tech.pem
    default_backend app_servers

backend acme_challenge
    server local_acme 127.0.0.1:8888

backend app_servers
    balance roundrobin
    option httpchk GET /health
    server app1 10.0.1.4:80 check
    server app2 10.0.1.7:80 check
